<!doctype html><html><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><title>syntax highlighting 2</title><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47887894-1', 'auto');
  ga('send', 'pageview');
</script><link href="/assets/css/base.css" media="screen" rel="stylesheet" type="text/css" /></head><body class="type images links layout navbar tables desktop-layout desktop-nav"><section><aside class="small" id="nav"><h2><a href="/">Exact<br />Change<br />Only</a></h2><br /><a href="mailto:adamwong246@gmail.com" title="email">adamwong246@gmail.com</a><br /><a class="github" href="https://github.com/adamwong246" title="githubalt"><span class="symbol">circlegithubalt</span></a><a class="stackoverflow" href="http://stackoverflow.com/users/614612/adamwong246" title="stackoverflow"><span class="symbol">circlestackoverflow</span></a><br /><a href="http://www.linkedin.com/profile/view?id=69760011&trk=nav_responsive_tab_profile" title="linkedin"><span class="symbol">circlelinkedin</span></a><a href="https://plus.google.com/104202656400776521456/posts?partnerid=gplp0" title="g_plus"><span class="symbol">circlegoogleplus</span></a><a href="https://twitter.com/adamwong246" title="twitter"><span class="symbol">circletwitter</span></a><a href="https://www.facebook.com/adamwong246" title="facebook"><span class="symbol">circlefacebook</span></a><br /><a href="/about_me.html">about</a><br /><a href="/blog/tags/posts.html">posts</a><br /><a href="/blog/tags/experiments.html">experiments</a><br /><a href="/blog/tags/log.html">log</a><br /><a href="/feed.xml" title="rss"><span class="symbol">circlerss</span></a></aside><div class="large" id="main">  <article>
    <h3>
      <a href="/blog/2014/01/25/syntax-highlighting-2.html">syntax highlighting 2</a> <span>Jan 25</span>
    </h3>
    
    <pre class="codehilite ruby"><span class="k">module</span> <span class="nn">Middleman</span>
  <span class="k">module</span> <span class="nn">Syntax</span>
    <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>

      <span class="k">def</span> <span class="nf">options</span>
        <span class="vc">@@options</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">registered</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">options_hash</span><span class="o">=</span><span class="p">{})</span>
        <span class="nb">require</span> <span class="s1">'rouge'</span>

        <span class="vc">@@options</span> <span class="o">=</span> <span class="n">options_hash</span>
        <span class="k">yield</span> <span class="vc">@@options</span> <span class="k">if</span> <span class="nb">block_given?</span>

        <span class="n">app</span><span class="p">.</span><span class="nf">send</span> <span class="ss">:include</span><span class="p">,</span> <span class="no">Helper</span>

        <span class="n">app</span><span class="p">.</span><span class="nf">after_configuration</span> <span class="k">do</span>
          <span class="k">if</span> <span class="n">markdown_engine</span> <span class="o">==</span> <span class="ss">:redcarpet</span>
            <span class="nb">require</span> <span class="s1">'middleman-core/renderers/redcarpet'</span>
            <span class="no">Middleman</span><span class="o">::</span><span class="no">Renderers</span><span class="o">::</span><span class="no">MiddlemanRedcarpetHTML</span><span class="p">.</span><span class="nf">send</span> <span class="ss">:include</span><span class="p">,</span> <span class="no">MarkdownCodeRenderer</span>
          <span class="k">elsif</span> <span class="n">markdown_engine</span> <span class="o">==</span> <span class="ss">:kramdown</span>
            <span class="nb">require</span> <span class="s1">'kramdown'</span>
            <span class="no">Kramdown</span><span class="o">::</span><span class="no">Converter</span><span class="o">::</span><span class="no">Html</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span>
              <span class="k">def</span> <span class="nf">convert_codeblock</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
                <span class="kp">attr</span> <span class="o">=</span> <span class="n">el</span><span class="p">.</span><span class="nf">attr</span><span class="p">.</span><span class="nf">dup</span>
                <span class="n">language</span> <span class="o">=</span> <span class="n">extract_code_language!</span><span class="p">(</span><span class="kp">attr</span><span class="p">)</span>
                <span class="no">Middleman</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Highlighter</span><span class="p">.</span><span class="nf">highlight</span><span class="p">(</span><span class="n">el</span><span class="p">.</span><span class="nf">value</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
              <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
      <span class="k">alias</span> <span class="ss">:included</span> <span class="ss">:registered</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">Highlighter</span>
      <span class="c1"># A helper module for highlighting code</span>
      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">highlight</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="o">::</span><span class="no">Middleman</span><span class="o">::</span><span class="no">Syntax</span><span class="p">.</span><span class="nf">options</span><span class="p">.</span><span class="nf">dup</span>
        <span class="n">lexer</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexer</span><span class="p">.</span><span class="nf">find_fancy</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span> <span class="o">||</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">PlainText</span>
        
        <span class="n">formatter</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">HTML</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">opts</span><span class="p">.</span><span class="nf">reverse_merge</span><span class="p">({</span> <span class="ss">:css_class</span> <span class="o">=&gt;</span> <span class="s2">"highlight </span><span class="si">#{</span><span class="n">lexer</span><span class="p">.</span><span class="nf">tag</span><span class="si">}</span><span class="s2">"</span> <span class="p">}))</span>
        <span class="n">formatter</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">lexer</span><span class="p">.</span><span class="nf">lex</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">opts</span><span class="p">))</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">Helper</span>

      <span class="c1"># Output highlighted code. Use like:</span>
      <span class="c1">#</span>
      <span class="c1">#    &lt;% code('ruby') do %&gt;</span>
      <span class="c1">#      my code</span>
      <span class="c1">#    &lt;% end %&gt;</span>
      <span class="c1">#</span>
      <span class="c1"># To produce the following structure:</span>
      <span class="c1">#</span>
      <span class="c1">#    &lt;div class="highlight"&gt;</span>
      <span class="c1">#      &lt;pre&gt;#{your code}</span>
      <span class="c1">#      &lt;/pre&gt;</span>
      <span class="c1">#    &lt;/div&gt;</span>
      <span class="c1">#</span>
      <span class="c1"># @param [String] language the Pygments lexer to use</span>
      <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="c1"># Save current buffer for later</span>
        <span class="vi">@_out_buf</span><span class="p">,</span> <span class="n">_buf_was</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="vi">@_out_buf</span>

        <span class="k">begin</span>
          <span class="n">content</span> <span class="o">=</span> <span class="k">if</span> <span class="nb">block_given?</span>
            <span class="n">capture_html</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
          <span class="k">else</span>
            <span class="s2">""</span>
          <span class="k">end</span>
        <span class="k">ensure</span>
          <span class="c1"># Reset stored buffer</span>
          <span class="vi">@_out_buf</span> <span class="o">=</span> <span class="n">_buf_was</span>
        <span class="k">end</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="no">Encoding</span><span class="o">::</span><span class="no">UTF_8</span><span class="p">)</span>
        <span class="n">concat_content</span> <span class="no">Middleman</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Highlighter</span><span class="p">.</span><span class="nf">highlight</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">MarkdownCodeRenderer</span>
      <span class="k">def</span> <span class="nf">block_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
        <span class="no">Middleman</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Highlighter</span><span class="p">.</span><span class="nf">highlight</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>

    
  </article>
</div><hr /><div class="xsmall" id="aside"><p>The thoughts and writing expressed herein are mine alone and do not reflect upon my employer nor any other organization or individual. </p><a href="https://github.com/adamwong246/adamwong246.github.io">source</a><div class="signature"><object><svg viewBox="0 0 640 480" xmlns="http://www.w3.org/2000/svg"><!-- Created with SVG-edit - http://svg-edit.googlecode.com/ --><g><title>Layer 1</title><g id="svg_1"><path stroke="#FFFFFF" fill="none" stroke-width="5" stroke-dasharray="null" stroke-linejoin="null" stroke-linecap="null" id="svg_28" d="m31.497704,329.275909c1.397758,0 5.713264,-1.109741 12.579849,-4.193268c8.553589,-3.841125 20.910904,-9.939575 55.910461,-22.364166c27.911491,-9.908386 70.982491,-22.026184 123.002998,-36.341827c104.267654,-28.693573 184.504471,-50.319382 271.165665,-72.683578l82.467896,-16.773132"></path><path stroke="#FFFFFF" fill="none" stroke-width="5" stroke-dasharray="null" stroke-linejoin="null" stroke-linecap="null" id="svg_26" d="m30.099941,448.085632c0,1.397766 -2.039057,1.826233 -2.795521,0c-1.069811,-2.582703 1.232979,-11.221802 8.386566,-40.535065c4.098991,-16.796448 14.479336,-59.005249 30.750748,-106.229858c19.878845,-57.694504 42.760948,-113.476639 53.114929,-135.582855c10.605553,-22.64328 17.516258,-35.666718 25.159706,-41.932846c3.897415,-3.195099 8.407516,-5.249481 11.182083,-5.591049c5.71994,-0.70414 9.784332,-1.397758 11.182098,-1.397758c2.795517,0 4.310669,1.342094 5.591049,4.193291c3.083542,6.866592 8.020737,39.200333 13.9776,72.683578c9.219254,51.820892 21.512238,95.363663 40.53508,145.367172c8.029282,21.105835 13.977615,40.535095 18.170898,48.921661c1.397766,2.795532 2.635117,-0.066315 5.591049,-6.988831c6.632416,-15.53241 17.016357,-37.637604 32.148499,-74.081329c15.627228,-37.635986 22.672363,-64.303024 47.523895,-82.467911c6.076904,-4.441833 -5.819092,32.365311 1.397766,111.820908c2.72934,30.049835 17.116272,38.395233 30.750732,29.352997c22.254883,-14.759308 89.456757,-132.787338 190.095551,-272.563477l39.137329,-51.717167l0,-4.193287"></path></g></g></svg></object></div></div></section></body></html>